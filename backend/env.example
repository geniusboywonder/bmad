# ===== BMAD ENTERPRISE BACKEND CONFIGURATION =====
# Production-ready environment configuration for BMAD v5.0

# ===== APPLICATION CONFIGURATION =====
APP_NAME=BMAD Enterprise AI Orchestration Platform
APP_VERSION=5.0.0
APP_ENVIRONMENT=production  # development, staging, production
DEBUG=false
LOG_LEVEL=INFO
SECRET_KEY=your_super_secure_secret_key_here_64_chars_minimum

# ===== DATABASE CONFIGURATION =====
# Production PostgreSQL with connection pooling
DATABASE_URL=postgresql+psycopg://bmad_user:secure_password@db-host:5432/bmad_prod_db?sslmode=require&pool_pre_ping=true&pool_recycle=300
DATABASE_TEST_URL=postgresql+psycopg://bmad_test:bmad_password@db-host:5432/bmad_test_db

# Database connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600

# ===== REDIS CONFIGURATION =====
# Redis cluster for production scalability
REDIS_URL=redis://redis-host:6379/0
REDIS_CELERY_URL=redis://redis-host:6379/1
REDIS_CACHE_URL=redis://redis-host:6379/2
REDIS_SESSION_URL=redis://redis-host:6379/3

# Redis cluster settings
REDIS_CLUSTER_ENABLED=false
REDIS_SENTINEL_ENABLED=false
REDIS_MASTER_NAME=mymaster

# ===== LLM PROVIDER CONFIGURATION =====
# Primary LLM provider (Anthropic Claude)
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_MAX_TOKENS=128000
ANTHROPIC_TEMPERATURE=0.7

# Fallback LLM provider (OpenAI GPT-4)
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_MAX_TOKENS=128000
OPENAI_TEMPERATURE=0.7

# Backup LLM provider (Google Gemini)
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_MODEL=gemini-1.5-pro
GOOGLE_MAX_TOKENS=128000
GOOGLE_TEMPERATURE=0.7

# LLM provider failover settings
LLM_REQUEST_TIMEOUT=60
LLM_MAX_RETRIES=3
LLM_RETRY_DELAY=5
LLM_CIRCUIT_BREAKER_THRESHOLD=5

# ===== API CONFIGURATION =====
API_V1_PREFIX=/api/v1
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false

# CORS configuration for production
CORS_ORIGINS=["https://yourdomain.com", "https://app.yourdomain.com"]
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=["GET", "POST", "PUT", "DELETE", "OPTIONS"]
CORS_ALLOW_HEADERS=["*"]
CORS_MAX_AGE=86400

# ===== WEBSOCKET CONFIGURATION =====
WS_HEARTBEAT_INTERVAL=30
WS_MAX_CONNECTIONS=1000
WS_MESSAGE_QUEUE_SIZE=1000
WS_CONNECTION_TIMEOUT=300
WS_PING_INTERVAL=25
WS_PING_TIMEOUT=10

# ===== SECURITY CONFIGURATION =====
# JWT and authentication
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7

# OAuth2 / Social login (optional)
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret

# Rate limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_BURST_SIZE=100

# Security headers
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_CONTENT_SECURITY_POLICY=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'
SECURITY_X_FRAME_OPTIONS=DENY
SECURITY_X_CONTENT_TYPE_OPTIONS=nosniff

# ===== MONITORING & OBSERVABILITY =====
# Prometheus metrics
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Logging configuration
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/bmad/application.log
LOG_MAX_FILE_SIZE=100MB
LOG_BACKUP_COUNT=5

# Structured logging
STRUCTLOG_ENABLED=true
STRUCTLOG_PROCESSORS=json

# ===== CACHE CONFIGURATION =====
CACHE_ENABLED=true
CACHE_TTL_SECONDS=3600
CACHE_MAX_MEMORY_MB=512
CACHE_COMPRESSION=true

# ===== FILE STORAGE =====
# File upload configuration
MAX_UPLOAD_SIZE_MB=100
ALLOWED_FILE_TYPES=["pdf", "doc", "docx", "txt", "md", "yaml", "yml", "json"]
UPLOAD_PATH=/var/bmad/uploads

# ===== EMAIL CONFIGURATION =====
EMAIL_ENABLED=true
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USERNAME=your_email@gmail.com
EMAIL_SMTP_PASSWORD=your_app_password
EMAIL_FROM_ADDRESS=noreply@yourdomain.com
EMAIL_TLS=true
EMAIL_SSL=false

# ===== NOTIFICATION CONFIGURATION =====
# Slack integration
SLACK_ENABLED=false
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
SLACK_CHANNEL=#bmad-alerts

# Webhook configuration
WEBHOOK_ENABLED=true
WEBHOOK_SECRET=your_webhook_secret
WEBHOOK_TIMEOUT=30

# ===== BACKGROUND TASKS =====
# Celery configuration
CELERY_BROKER_URL=redis://redis-host:6379/1
CELERY_RESULT_BACKEND=redis://redis-host:6379/2
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=["json"]
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Celery worker settings
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_TIME_LIMIT=3600

# ===== FEATURE FLAGS =====
# Feature toggles for gradual rollouts
FEATURE_TIME_CONSCIOUS_ORCHESTRATION=true
FEATURE_SELECTIVE_CONTEXT_INJECTION=true
FEATURE_HITL_PHASE_GATES=true
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_MULTI_AGENT_COORDINATION=true

# ===== COMPLIANCE & AUDIT =====
AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years for compliance
GDPR_COMPLIANT=true
DATA_RETENTION_DAYS=2555

# ===== PERFORMANCE OPTIMIZATION =====
# Database query optimization
SQLALCHEMY_ECHO=false
SQLALCHEMY_TRACK_MODIFICATIONS=false
SQLALCHEMY_ENGINE_OPTIONS={"pool_pre_ping": true, "pool_recycle": 300}

# Connection pooling
DATABASE_CONNECTION_POOL_SIZE=20
DATABASE_CONNECTION_MAX_OVERFLOW=30

# ===== BACKUP & RECOVERY =====
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 4 * * *  # Daily at 4 AM
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=true
BACKUP_ENCRYPTION=true

# ===== HEALTH CHECKS =====
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_EXTERNAL_APIS=true

# ===== DEVELOPMENT OVERRIDES =====
# These can be overridden in development environments
if [ "$APP_ENVIRONMENT" = "development" ]; then
    DEBUG=true
    LOG_LEVEL=DEBUG
    CORS_ORIGINS=["http://localhost:3000", "http://localhost:5173", "http://localhost:8000"]
    DATABASE_URL=postgresql+psycopg://bmad_user:bmad_password@localhost:5432/bmad_dev_db
    REDIS_URL=redis://localhost:6379/0
fi

# ===== STAGING ENVIRONMENT =====
if [ "$APP_ENVIRONMENT" = "staging" ]; then
    DEBUG=false
    LOG_LEVEL=INFO
    CORS_ORIGINS=["https://staging.yourdomain.com"]
    DATABASE_URL=postgresql+psycopg://bmad_staging:staging_password@staging-db:5432/bmad_staging_db
fi

fi
